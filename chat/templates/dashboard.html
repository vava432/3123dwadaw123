{% extends "base.html" %}

{% block content %}
<div class="dashboard">
    <header>
        <h2>Привет, {{ username }}!</h2>
        <a href="{{ url_for('logout') }}" class="btn">Выйти</a>
    </header>

    {% if error %}
    <div class="error">{{ error }}</div>
    {% endif %}

    <div class="rooms-section">
        <h2>Присоединиться к комнате</h2>
        <form method="POST" action="{{ url_for('join_room') }}" class="glass-card">
            <div class="form-group">
                <input type="text" name="room_link" placeholder="Ссылка комнаты" required>
            </div>
            <div class="form-group">
                <input type="password" name="room_password" placeholder="Пароль комнаты" required>
            </div>
            <button type="submit" class="btn">Присоединиться</button>
        </form>

        <h2>Создать новую комнату</h2>
        <a href="{{ url_for('create_room') }}" class="btn">Создать комнату</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Загружаем список посещенных комнат
    fetch('/get_visited_rooms')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('visited-rooms');
            if (data.rooms && data.rooms.length > 0) {
                container.innerHTML = '';
                data.rooms.forEach(room => {
                    const roomElement = document.createElement('div');
                    roomElement.className = 'visited-room';
                    roomElement.innerHTML = `
                        <h3><span class="room-name">${room.name}</span></h3>
                        <div class="room-actions">
                            <a href="/room/${room.link}" class="btn">Войти</a>
                            <button onclick="removeRoom('${room.link}')" class="btn">Удалить</button>
                        </div>
                    `;
                    container.appendChild(roomElement);
                });
            } else {
                container.innerHTML = '<p>Нет недавних комнат</p>';
            }
        });
});

function removeRoom(roomLink) {
    fetch(`/remove_from_visited_rooms/${roomLink}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Перезагружаем список
                location.reload();
            }
        });
}
</script>
{% endblock %}